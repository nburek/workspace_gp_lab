/*
 * Graphics.c
 *
 *  Created on: Apr 6, 2012
 *      Author: nb418308
 */

#include "Graphics.h"

double sin(int angle)
{
	double lTable[] = {0,0.174532925199433,0.349065850398866,0.523598775598299,0.698131700797732,0.872664625997165,1.0471975511966,1.22173047639603,1.39626340159546,1.5707963267949,1.74532925199433,1.91986217719376,2.0943951023932,2.26892802759263,2.44346095279206,2.61799387799149,2.79252680319093,2.96705972839036,0};

	while (angle>=360)
		angle-=360;

	if (angle<180)
		return lTable[(angle/10)];
	else
		return -1*lTable[(angle/10)];
}

double cos(int angle)
{
	return sin(angle+90);
}

void putPixel(int x, int y, u8 color)
{
	if (x < MAX_WIDTH && x>=0 && y < MAX_HEIGHT && y>=0)
		Xil_Out32(VGA_BASEADDR, ((y*MAX_WIDTH + x)<<3)| color);
}

void drawLine(int x1, int y1, int x2, int y2, u8 color)
{
	int n, deltax, deltay, sgndeltax, sgndeltay, deltaxabs, deltayabs, x, y, drawx, drawy;

	deltax = x2 - x1;
	deltay = y2 - y1;
	deltaxabs = (deltax<0)?(deltax*-1):deltax;//abs(deltax);
	deltayabs = (deltay<0)?(deltay*-1):deltay;//abs(deltay);
	sgndeltax = (deltax>0)?1:(deltax==0)?0:-1;//sgn(deltax);
	sgndeltay = (deltay>0)?1:(deltay==0)?0:-1;//sgn(deltay);
	x = deltayabs >> 1;
	y = deltaxabs >> 1;
	drawx = x1;
	drawy = y1;

	putPixel(drawx, drawy, color);

	if(deltaxabs >= deltayabs)
	{
		for(n = 0; n < deltaxabs; n++)
		{
			y += deltayabs;
			if(y >= deltaxabs)
			{
				y -= deltaxabs;
				drawy += sgndeltay;
			}
			drawx += sgndeltax;
			putPixel(drawx, drawy,color);
		}
	}
	else
	{
		for(n = 0; n < deltayabs; n++)
		{
			x += deltaxabs;
			if(x >= deltayabs)
			{
				x -= deltayabs;
				drawx += sgndeltax;
			}
			drawy += sgndeltay;
			putPixel(drawx, drawy,color);
		}
	}
}


void drawCircle(int x0, int y0, int radius, u8 color, u8 filled)
{
	int f = 1 - radius;
	int ddF_x = 1;
	int ddF_y = -2 * radius;
	int x = 0;
	int y = radius;

	if (filled==0)
	{
		putPixel(x0, y0 + radius,color);
		putPixel(x0, y0 - radius,color);
		putPixel(x0 + radius, y0,color);
		putPixel(x0 - radius, y0,color);
	}
	else
	{
		drawLine(x0, y0 + radius,x0, y0 - radius,color);
		drawLine(x0 + radius, y0 ,x0 - radius, y0,color);
	}



	while(x < y)
	{
		// ddF_x == 2 * x + 1;
		// ddF_y == -2 * y;
		// f == x*x + y*y - radius*radius + 2*x - y + 1;
		if(f >= 0)
		{
			y--;
			ddF_y += 2;
			f += ddF_y;
		}
		x++;
		ddF_x += 2;
		f += ddF_x;

		if (filled==0)
		{
			putPixel(x0 + x, y0 + y,color);
			putPixel(x0 - x, y0 + y,color);

			putPixel(x0 + x, y0 - y,color);
			putPixel(x0 - x, y0 - y,color);

			putPixel(x0 + y, y0 + x,color);
			putPixel(x0 - y, y0 + x,color);

			putPixel(x0 + y, y0 - x,color);
			putPixel(x0 - y, y0 - x,color);
		}
		else
		{
			drawLine(x0 + x, y0 + y,x0 - x, y0 + y,color);
			drawLine(x0 + y, y0 - x,x0 - y, y0 - x,color);
			drawLine(x0 + y, y0 + x,x0 - y, y0 + x,color);
			drawLine(x0 + x, y0 - y,x0 - x, y0 - y,color);

		}

	}
}

void fanFromPointToLine(int x1, int y1, int x2, int y2, int vX, int vY, u8 color)
{

	int n, deltax, deltay, sgndeltax, sgndeltay, deltaxabs, deltayabs, x, y, drawx, drawy;

	deltax = x2 - x1;
	deltay = y2 - y1;
	deltaxabs = (deltax<0)?(deltax*-1):deltax;//abs(deltax);
	deltayabs = (deltay<0)?(deltay*-1):deltay;//abs(deltay);
	sgndeltax = (deltax>0)?1:(deltax==0)?0:-1;//sgn(deltax);
	sgndeltay = (deltay>0)?1:(deltay==0)?0:-1;//sgn(deltay);
	x = deltayabs >> 1;
	y = deltaxabs >> 1;
	drawx = x1;
	drawy = y1;

	drawLine(drawx,drawy,vX,vY,color);

	if(deltaxabs >= deltayabs)
	{
		for(n = 0; n < deltaxabs; n++)
		{
			y += deltayabs;
			if(y >= deltaxabs)
			{
				y -= deltaxabs;
				drawy += sgndeltay;
			}
			drawx += sgndeltax;
			drawLine(drawx,drawy,vX,vY,color);
		}
	}
	else
	{
		for(n = 0; n < deltayabs; n++)
		{
			x += deltaxabs;
			if(x >= deltayabs)
			{
				x -= deltayabs;
				drawx += sgndeltax;
			}
			drawy += sgndeltay;
			drawLine(drawx,drawy,vX,vY,color);
		}
	}
}

void drawTriangle(int x1, int y1, int x2, int y2, int x3, int y3, u8 color, u8 filled)
{
	if (filled == 0)
	{
		drawLine(x1,y1,x2,y2,color);
		drawLine(x3,y3,x2,y2,color);
		drawLine(x1,y1,x3,y3,color);
	}
	else
	{
		fanFromPointToLine(x1,y1,x2,y2,x3,y3,color);
		fanFromPointToLine(x3,y3,x1,y1,x2,y2,color);
		fanFromPointToLine(x2,y2,x3,y3,x1,y1,color);
	}
}





uint m_w = 25;    /* must not be zero */
uint m_z = 683;    /* must not be zero */

uint randNum()
{
    m_z = 36969 * (m_z & 65535) + (m_z >> 16);
    m_w = 18000 * (m_w & 65535) + (m_w >> 16);
    return (m_z << 16) + m_w;  /* 32-bit result */
}
